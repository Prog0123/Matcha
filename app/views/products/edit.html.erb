<!-- Á∑®ÈõÜ„Éö„Éº„Ç∏ -->
<div class="max-w-4xl mx-auto px-4 mt-8">

  <%= form_with model: @product, local: true, class: "space-y-2" do |f| %>
    <% if @product.errors.any? %>
      <div class="alert alert-error">
        <ul>
          <% @product.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- ÂïÜÂìÅÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ -->
    <div class="card bg-white shadow-md p-6 rounded-xl">
      <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
        üìù ÂïÜÂìÅÊÉÖÂ†±
      </h3>
      
      <div class="space-y-4">
        <div class="form-control">
          <%= f.label :name, "ÂïÜÂìÅÂêç", class: "label" %>
          <%= f.text_field :name, class: "input input-bordered w-full", placeholder: "‰æãÔºö„ÉÅ„Éß„Ç≥„É¨„Éº„Éà„Ç±„Éº„Ç≠" %>
        </div>

        <div class="form-control">
          <%= f.label :shop_name, "Â∫óËàóÂêç", class: "label" %>
          <%= f.text_field :shop_name, class: "input input-bordered w-full", placeholder: "‰æãÔºö„Éë„ÉÜ„Ç£„Çπ„É™„Éº‚óã‚óã" %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-control">
            <%= f.label :category, "„Ç´„ÉÜ„Ç¥„É™", class: "label" %>
            <%= f.select :category, [
              ["„Ç±„Éº„Ç≠", "cake"],
              ["„Éá„Ç∂„Éº„Éà", "dessert"],
              ["„Ç¢„Ç§„Çπ", "ice_cream"],
              ["ÂíåËèìÂ≠ê", "japanese_sweets"],
              ["„Éâ„É™„É≥„ÇØ", "drink"],
              ["„Éë„Éï„Çß", "parfait"],
              ["„Åù„ÅÆ‰ªñ", "other"]
            ], { prompt: "„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ" }, { class: "select select-bordered w-full" } %>
          </div>

          <div class="form-control">
            <%= f.label :price, "‰æ°Ê†ºÔºàÂÜÜÔºâ", class: "label" %>
            <div class="relative">
              <%= f.number_field :price, class: "input input-bordered w-full pr-12", placeholder: "500", min: 0 %>
              <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">ÂÜÜ</span>
            </div>
          </div>
        </div>

        <div class="form-control">
          <%= f.label :tag_names, "„Çø„Ç∞Ôºà„Ç´„É≥„ÉûÂå∫Âàá„ÇäÔºâ", class: "label" %>
          <%= f.text_field :tag_names, value: @product.tag_names, class: "input input-bordered w-full", placeholder: "‰æãÔºö„ÉÅ„Éß„Ç≥„É¨„Éº„Éà, ÊøÉÂéö, „Åä„Åô„Åô„ÇÅ" %>
        </div>
      </div>
    </div>

    <!-- Âë≥Ë¶öË©ï‰æ°„Çª„ÇØ„Ç∑„Éß„É≥ -->
    <%= f.fields_for :review, (@product.review || @product.build_review) do |rf| %>
      <div class="card bg-white shadow-md p-6 rounded-xl">
        <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b border-gray-200 pb-2">
          ‚≠ê Âë≥Ë¶öË©ï‰æ°
        </h3>
        
        <div class="space-y-4">
          <% [
            ["ÊøÉ„Åï", :richness, "‚òÖ"],
            ["Áîò„Åï", :sweetness, "‚òÖ"],
            ["Ëã¶Âë≥", :bitterness, "‚òÖ"],
            ["ÂæåÂë≥", :aftertaste, "‚òÖ"],
            ["Ë¶ã„ÅüÁõÆ", :appearance, "‚òÖ"]
          ].each do |label, name, symbol| %>
            <div class="form-control"
                 data-controller="stars"
                 data-stars-name="product[review_attributes][<%= name %>]"
                 data-stars-symbol-value="<%= symbol %>">

              <div class="flex items-center justify-between bg-gray-50 p-4 rounded-lg">
                <!-- „É©„Éô„É´ÈÉ®ÂàÜ -->
                <div class="w-16 flex-shrink-0">
                  <span class="text-sm font-medium text-gray-700"><%= label %></span>
                </div>

                <!-- ÊòüË©ï‰æ°ÈÉ®ÂàÜ -->
                <div class="flex space-x-1">
                  <% 5.times do |i| %>
                    <i class="star cursor-pointer text-2xl text-gray-400 hover:text-yellow-400 transition-colors"
                       data-action="click->stars#select"
                       data-value="<%= i + 1 %>"><%= symbol %></i>
                  <% end %>
                </div>

                <!-- Êï∞ÂÄ§Ë°®Á§∫ÈÉ®ÂàÜ -->
                <div class="flex items-center bg-white px-3 py-2 rounded-lg shadow-sm">
                  <span class="text-lg font-bold text-gray-700 min-w-[1.5rem]" data-stars-target="display">
                    <%= @product.review&.send(name) || 0 %>
                  </span>
                  <span class="text-sm text-gray-500 ml-1">/ 5</span>
                </div>
              </div>
              
              <%= rf.hidden_field name, 
                  value: @product.review&.send(name) || 0,
                  data: { stars_target: "input" } %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- ÁîªÂÉè„Éª„Ç≥„É°„É≥„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <div class="card bg-white shadow-md p-6 rounded-xl">
        <h3 class="text-lg font-semibent mb-4 text-gray-800 border-b border-gray-200 pb-2">
          üì∑ ÁîªÂÉè„Éª„Ç≥„É°„É≥„Éà
        </h3>
        
        <div class="space-y-4">
          <div class="form-control">
            <%= f.label :image, "ÁîªÂÉè", class: "label" %>
            <% if @product.image.attached? %>
              <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-600 mb-2">ÁèæÂú®„ÅÆÁîªÂÉè:</p>
                <%= image_tag @product.image, class: "w-48 h-48 object-cover rounded-lg shadow-sm" %>
              </div>
            <% end %>
            <%= f.file_field :image, class: "file-input file-input-bordered w-full", accept: "image/*" %>
            <label class="label">
              <span class="label-text-alt text-gray-500">JPG„ÄÅPNG„ÄÅGIFÂΩ¢Âºè„ÅÆÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÂ§âÊõ¥„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøÔºâ</span>
            </label>
          </div>

          <div class="form-control">
            <%= rf.label :comment, "„Ç≥„É°„É≥„Éà", class: "label" %>
            <%= rf.text_area :comment, class: "textarea textarea-bordered w-full h-32", placeholder: "ÂïÜÂìÅ„ÅÆÊÑüÊÉ≥„ÇÑÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„ÇíËá™Áî±„Å´„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑ..." %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Êõ¥Êñ∞„Éú„Çø„É≥ -->
    <div class="flex justify-end space-x-3 pt-4 mb-4">
      <%= link_to "„Ç≠„É£„É≥„Çª„É´", product_path(@product), class: "btn btn-outline" %>
      <%= f.submit "ÂïÜÂìÅ„ÇíÊõ¥Êñ∞„Åô„Çã", class: "btn btn-primary" %>
    </div>

  <% end %>
</div>